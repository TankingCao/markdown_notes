---
title: 计算机网络
date: 2023-10-26 21:04:32
categories: 
    - 计算机
tags: 计算机网络
---

# 计算机网络

## 1. 计算机网络概述

### 1.1 计算机网络在信息时代中的作用

> 21世纪是以数字化、网络化、信息化为重要特征的信息时代，作为信息的最大载体和传输媒介，网络已成为这个信息时代的核心基础

### 1.2 计算机网络的定义与分类

#### 1.2.1 定义

简单定义：==硬件==（独立和连接）+==软件==（协议）+==目的==（共享和通信）

> ==**计算机网络就是以传输信息为基本目的，用通信线路和通信设备将多个计算机连接起来的计算机系统的集合**==

#### 1.2.2 分类

> 按网络覆盖范围进行分类

1. 局域网（Local Area Network,`LAN`，一个实验室、一幢楼、一个校园）
2. 城域网（Metropolitan Area Network,`MAN`，几个街区甚至整个城市，5-50 km）
3. 广域网（Wide Area Network,`WAN`，覆盖一个国家或地区甚至几个洲，也称为**远程网**）
4. 个人区域网（Personal Area Network,`PAN`，10 m以内）

> 按网络的使用者进行分类

1. 公用网（所有愿意缴纳费用的人都能使用）
2. 专用网（专门为本单位的特殊业务工作建造的，例如，军队、铁路、电力等系统）

![计算机网络分类](https://gitee.com/clibin/image-bed/raw/master/CopyQ.TZiqFW.png)

### 1.3 互联网概述

#### 1.3.1 网络的网络

1. 网络

> ==网络==由==若干节点==（Node）和连接这些节点的==链路==(Link)组成
>
> 节点：可以是计算机、集线器、交换机、路由器

<img src="https://gitee.com/clibin/image-bed/raw/master/image-20231024224626941.png" alt="网络" style="zoom:80%;" />

2. 互连网络（internet，通用名词，注意和 Internet互联网 区分）

> 将网络用路由器连接起来就成了互连网络，因此互连网络是==网络的网络==

<img src="https://gitee.com/clibin/image-bed/raw/master/image-20231024224534363.png" alt="互连网络" style="zoom:80%;" />

> 总结：==**网络把许多计算机连接在一起，而互联网络则把许多网络连接在一起**==

3. 互联网（Internet，也称 因特网）

> 当前全球最大的、开放的、由众多网络相互连接而成的特定计算机网络，采用TCP/IP协议作为通信规则，前身是美国的阿帕网（ARPANet）

1. 边缘部分：用户直接使用的
2. 核心部分：为边缘部分提供服务的

<img src="https://gitee.com/clibin/image-bed/raw/master/image-20231024224804841.png" alt="互联网的边缘部分和核心部分" style="zoom: 67%;" />

#### 1.3.2 互联网结构发展的三个阶段

1. 第一阶段：从单个网络ARPANET向互连网络发展
2. 第二阶段：逐步建成三级结构的互联网
3. 第三阶段：逐渐形成多层次的ISP结构的互联网

<img src="https://gitee.com/clibin/image-bed/raw/master/image-20231024225143618.png" alt="ISP" style="zoom: 67%;"/>

### 1.4 电路交换和分组交换

#### 1.4.1 电路交换

![电路交换](https://gitee.com/clibin/image-bed/raw/master/image-20231024225354835.png)

> 这种必须经过
>
> 1. `建立连接`（分配通信资源）
>
> 2. `通信`（一直占用通信资源）
>
> 3. `释放连接`（归还通信资源）
>
> 三个步骤的交换方式称为==电路交换==
>
> 电路交换：电路交换是指在通信开始之前，建立一条专用的物理连接，然后在通信过程中一直占用这条连接，直到通信结束。在这个过程中，数据被分成固定大小的数据包，每个数据包都被分配一个专用的物理通路。
>
> 优点：传输==速度快==
>
> 缺点：连接建立需要时间，且连接一旦建立就无法被其他通信使用

#### 1.4.3 报文交换

> 整个报文传送到相邻结点，全部存储下来后查找转发表，转发到下一个结点。

#### 1.4.2 分组交换

<img src="https://gitee.com/clibin/image-bed/raw/master/image-20231024225503293.png" alt="分组交换" style="zoom: 80%;" />

> 我们通常把要发送的整块数据称为一个`报文`（Message）
>
> 发送报文之前，先将报文划分为一个个更小的等长的数据段，在数据段前面加上`首部`（又称为`包头`）就构成了`分组`（又称为`包`）

> 分组交换：分组交换是指`将数据分成较小的数据包`，每个数据包都带有目标地址和源地址等信息，然后通过网络传输。在传输过程中，每个数据包都独立传输，可以通过不同的路径到达目的地，由于每个分组交换机都是先存储下来再转发出去，因此该方法被称为`存储转发`方式
>

![交换方式对比](https://gitee.com/clibin/image-bed/raw/master/CopyQ.hVntPh.png)

### 1.5 计算机网络的主要性能指标

#### 1. 速率

> 1. ==数据的传输速率==，也称为`数据率`、`比特率` 1字节(byte)=8比特(bit)
>
> 2. 单位是 `bit/s 或 bps` ,比特是数据量的单位，是一个`二进制数字`(0或1)
> 3. 一般来说，$$k = 10^3,K = 2^{10}$$,但有时又不严格区分，统一表示1000，稍微注意一下

<img src='https://gitee.com/clibin/image-bed/raw/master/CopyQ.aGEcPX.png' alt='速率'>

#### 2. 带宽

1. 带宽本来是指某个`信号具有的频带宽度`，表示通信线路允许通过的信号频带范围,单位为赫兹

2. 计算机网络中，带宽表示网络某通道传输能力，即==最高数据率==,单位为`比特每秒`（bit/s）

   <img src="https://gitee.com/clibin/image-bed/raw/master/CopyQ.UEfjHW.png" alt='带宽'/>

#### 3. 吞吐量

> 也称为`吞吐率`，表示单位时间内通过某个网络（或信道、接口）的数据量

#### 4.时延

> 时延是指==数据从网络的一端传送到另外一端所需要的时间==，也称为`延迟`或`迟延`
>
> 网络中的时延通常由以下几个不同的部分组成：
>
> 1. ==发送时延：主机或路由器将整个分组的所有比特发送到通信线路上所需要的时间==
>    $$
>    发送时延 = \frac{分组长度}{发送速率}
>    $$
>
> 2. ==传播时延：是电磁波在信道中传播一定距离所花费的时间==
>    $$
>    传播时延 = \frac{信道长度}{电磁波在信道上的传播速度}
>    $$
>
> 3. 处理时延：主机或路由器在收到分组时处理分组花费的时间（一般不方便计算）

<img src="https://gitee.com/clibin/image-bed/raw/master/CopyQ.hzERwE.png" alt='时延'/>

![时延](https://gitee.com/clibin/image-bed/raw/master/202310261920366.png)

#### 5. 时延带宽积 往返时间 利用率 丢包率

<img src="https://gitee.com/clibin/image-bed/raw/master/CopyQ.XBpSgv.png" alt=""/>

### 1.6 计算机网络体系结构

#### 1.6.1 网络协议

网络协议主要由以下三要素组成：

1. ==语法：数据与控制信息的结构或格式==（例如，地址字段多长以及它在分组的什么位置）
2. ==语义：各个控制信息的具体含义==（需要发出何种控制信息、完成何种动作及做出何种响应）
3. ==同步：事件实现的顺序和时间的详细说明==（数据何时发出以及以什么速率发出）

#### 1.6.2 常见的计算机网络分层体系结构

![常见的计算机网络分层体系结构](https://gitee.com/clibin/image-bed/raw/master/CopyQ.uQqXEZ.png)

#### 1.6.3 具有五层协议的原理体系结构

> 我们学习的是具有五层协议的原理体系结构

![原理体系结构](https://gitee.com/clibin/image-bed/raw/master/CopyQ.EvnJQE.png)

#### 1.6.4 实体、协议和服务

> **==协议是水平的,服务是垂直的==**
>
> 1. 实体：任何可发送或接收信息的硬件或软件进程
> 2. 协议：==**控制两个或多个对等实体之间通信的规则的集合**==
> 3. ==**下层通过层级接口向上层提供服务，下面的协议对上面的实体是”透明“的**==
> 4. 透明：某个实际存在的事物看起来好像不存在一样

![实体、协议和服务](https://gitee.com/clibin/image-bed/raw/master/CopyQ.ZGZDeQ.png)

![TCP/IP参考模型中的协议](https://cdn.processon.com/62913fa9e4b0c71a3a81421f?e=1653689786&token=trhI0BY8QfVrIGn9nENop6JAc6l5nZuxhjQ62UfM:-WUsRKcHkAR_OnyY966rAE8wIOw=)

#### 1.6.5 相关习题

![](https://gitee.com/clibin/image-bed/raw/master/202310261924466.png)

![](https://gitee.com/clibin/image-bed/raw/master/202310261924745.png)

![](https://gitee.com/clibin/image-bed/raw/master/202310261925145.png)

#### 1.6.6 相关资料链接

1. [第1章 概述（思维导图）](https://www.kdocs.cn/view/l/cqzI95zH7t6v)

---

## 2. 物理层

> ==**任务：怎样在连接各种计算机的传输媒体上传输数据比特流**==（使数据链路层感觉不到各种传输媒体之间的差异，只需要使用物理层服务就能传输比特流，不必关心具体怎么实现）

### 2.1 物理层的基本概念

![物理层的基本概念](https://gitee.com/clibin/image-bed/raw/master/202310261930116.png)

### 2.2 数据通信的基础知识

#### 2.2.1 数据通信的基础知识

#### 2.2.2 编码与调制

1. 定义

   - ==模拟信号==：消息的参数的取值是连续的
   - ==数字信号==：消息的参数的取值是离散的

   - ==编码==：将数字数据转换成数字信号的过程
   - ==调制==：将数字数据转换成模拟信号的过程

![编码与调制](https://gitee.com/clibin/image-bed/raw/master/202310262020595.png)

2. 常用编码方式

![常用编码方式](https://gitee.com/clibin/image-bed/raw/master/202310262040597.png)

3. 基本的调制方法

![基本的调制方法](https://gitee.com/clibin/image-bed/raw/master/202310262047837.png)

4. **==相位调制==**

> **8相位调制**表示8种状态，只需要**3个比特**(二进制，$2^3=8$)即可,所以**1个码元可以承载3个比特**，**==数据传输率 = 3*波特率==**，以此类推

#### 2.2.3 信道的极限容量

![信号失真](https://gitee.com/clibin/image-bed/raw/master/202310262054137.png)

> ==**奈式准则**==

![奈式准则](https://gitee.com/clibin/image-bed/raw/master/202310262059898.png)

> **==香农公式==**
> $$
> c = W \cdot \log_{2}(1 + \frac{S}{N})
> $$
> ==知道信噪比(dB)求S/N假设信噪比为30dB==
>
> 1. 30 = 10 x lg(S/N), 
>
> 2. lg(S/N) = 3,
>
> 3. S/N = 30

![香农公式](https://gitee.com/clibin/image-bed/raw/master/202310262102013.png)

> 1. 在信道带宽一定的情况下，根据奈氏准则和香农公式，要想==提高信息的传输速率==就必须采用==多元制==（更好的调制方法）和努力==提高信道中的信噪比==
> 2. 自从香农公式发表后，各种新的信号处理和调制方法就不断出现，其目的都是为了尽可能地==接近香农公式给出的传输速率极限==

#### 2.2.4 传输方式

1. 并行传输和串行传输

> - 并行传输速度是串行传输的==n倍==，但是<span color='rgb(1,2,3)'>成本高</span>==所以长距离传输使用串行传输==
>- 远距离传输使用串行传输，计算机内部使用并行传输

![并行传输和串行传输](https://gitee.com/clibin/image-bed/raw/master/202310262005937.png)

2. 异步传输和同步传输

> 异步传输==字节之间异步==，但是要添加==开始码==和==停止码==作为引导

<img src="https://gitee.com/clibin/image-bed/raw/master/202310262010168.png" alt="异步传输和同步传输"  />

3. 单工、半双工和全双工通信

![单工、半双工和全双工通信](https://gitee.com/clibin/image-bed/raw/master/202310262014965.png)

### 2.3 物理层下的传输媒体（了解即可）

#### 2.3.1 导引型传输媒体

1. **同轴电缆**

![同轴电缆](https://gitee.com/clibin/image-bed/raw/master/202310261938546.png)

2. **双绞线**

![双绞线](https://gitee.com/clibin/image-bed/raw/master/202310261942966.png)

3. **光纤**

![光纤](https://gitee.com/clibin/image-bed/raw/master/202310261946552.png)

#### 2.3.2 非导引型传输媒体

1. **微波**

![微波](https://gitee.com/clibin/image-bed/raw/master/202310261954118.png)

2. 其他无线电波
3. 红外线和可见光

### 2.4 信道复用技术

> 复用：当网络中传输媒体的传输容量大于多条单一信道传输的总通信量时，可利用复用技术==在一条物理线路上建立多条通信信道==来共享传输媒体的带宽。

<img src="https://gitee.com/clibin/image-bed/raw/master/image-20231027222210209.png" alt="信道复用" style="zoom:80%;" />

#### 2.4.1 频分复用

> **频分复用**(Frequency-division multiplexing,`FDM`):==将多路基带信号调制到不同频率载波==上，再进行==叠加形成一个复合信号==,接收端的分用器通过滤波将各路信号滤出，将合成的复合信号恢复成原始的多路信号。

<img src="https://gitee.com/clibin/image-bed/raw/master/202310272254062.png" style="zoom: 67%;" />

#### 2.4.2 时分复用

> 时分复用(Time Division Multiplexing,`TDM`)：将传输线路的带宽资源==按时间轮流分配==给不同的用户，用户只能在分配的时间里使用线路传输数据（类似于==时间片轮转==）
>
> 存在的不足：使用时分复用系统传送计算机数据时，由于计算机数据的突发性质，用户对分配到的子信道的利用率一般不高。（如果A暂时不使用信道，其他用户正常使用，时分复用还是会给A分配时间，而且这段时间内其他用户也不能使用）

<img src="https://gitee.com/clibin/image-bed/raw/master/202310272254453.png" alt="时分复用" style="zoom: 67%;" />

> 统计时分复用(statistical time division multiplexing,`STDM`):==动态地按需分配==共用信道的时隙，只将需要传送数据的终端接入共用信道，可以提高信道的利用率
>
> 帧与帧之间留有空隙用来存储用户的地址信息，因为不是固定的分配给某个用户

![STDM](https://gitee.com/clibin/image-bed/raw/master/202310281701023.png)

#### 2.4.3 波分复用

> 波分复用(Wavelength Division Multiplexing,`WDM`)就是==光的频分复用==。使用一根光纤来同时传输多个光载波信号。现在已能做到在一根光纤上复用几十路或更多路数的光载波信号。

![波分复用](https://gitee.com/clibin/image-bed/raw/master/202310282020333.png)

#### 2.4.3 码分复用

> - 码分复用(Code Division Multiplexing,`CDM`)一种共享信道的方法。
> - 由于该技术主要用于无线多址接入（本书中我们不严格区分多址与复用）人们更常用的名词是码分多址CDMA(Code Division Multiple Access)。
> - 每一个用户可以在同样的时间使用同样的频带进行通信。==各用户使用经过特殊挑选的不同码型，因此彼此不会造成干扰==。
>
> - 最初用于军事，因为这种系统发送的信号==有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现==

![码分复用](https://gitee.com/clibin/image-bed/raw/master/202310282039043.png)

> 规格化内积：将码片序列先写成+1和-1的向量
>
> 例如：==码片序列为（1101）>>> 向量为(+1,+1,-1,+1)==
>
> 向量相乘/向量个数 = 内积
>
> - **内积为1  >>> 发送信号1** ==发送的是自己的码片序列==
> - **内积为0  >>> 未发送信号** ==未发送数据==
> - **内积为-1 >>> 发送信号0** ==发送的是自己的码片序列的二进制反码==

### 2.5 相关习题和资料

1. [第2章 物理层 习题](https://www.kdocs.cn/view/l/cfixYkxNJ7Ep)
2. [第2章 物理层（思维导图）](https://www.kdocs.cn/view/l/ckmnMjp5UQvK)

---

## 3. 数据链路层

> **==任务：解决数据包在一个网络或一段链路上传输的问题==**



### 3.1 数据链路和帧

> - ==链路==（Link）是指从一个节点到相邻节点的一段物理线路（有线或无线），而中间没有任何其他的交换节点
> - ==数据链路==（Data Link）是基于链路的。当在一条链路上传送数据时，除需要链路本身，还需要一些必要的通信协议来控制这些数据的传输，把==实现这些协议的硬件和软件加到链路==上，就构成了数据链路
> - 计算机中的==网络适配器==（俗称网卡）和其相应的软件驱动程序就实现了这些协议。一般的网络适配器都包含了物理层和数据链路层这两层的功能
> - ==帧==（Frame）是数据链路层的协议数据单元

### 3.2 封装成帧和透明传输

#### 3.2.1 封装成帧

![封装成帧](https://gitee.com/clibin/image-bed/raw/master/202310291347647.png)

#### 3.2.2 透明传输问题

> **==2. 透明传输问题出现原因==**：上层应用交付的数据单元中可能==含有和帧定界符相同的数据==而被接收端误认为帧定界符从而导致错误。
>
> 如果不解决上述问题，则数据链路层就会==对上层交付的PDU的内容有所限制==，即==PDU中不能包含帧定界符==。显然，这样的数据链路层没有什么应用价值。
>
> ==**透明传输**==：数据链路层对上层交付的PDU的内容==没有任何限制==，就好像数据链路层不存在一样

<img src="https://gitee.com/clibin/image-bed/raw/master/202310291859630.png" alt="透明传输问题" style="zoom: 67%;" />

#### 3.2.3 解决透明传输问题

1. **==字符填充==(字节填充)**

![字符填充](https://gitee.com/clibin/image-bed/raw/master/image-20231029190744213.png)

2. **==零比特填充==**

![零比特填充](https://gitee.com/clibin/image-bed/raw/master/image-20231029192326597.png)

### 3.3 差错检测

> 1. ==**比特差错**==：比特在传输过程中可能会产生差错，0可能变为1,1可能变为0，这叫比特差错，也称为**==误码==**
>
> 2. **==误码率==**：传输==错误的==比特数与所传输比特==总数==的比率称为误码率
> 3. 使用==差错检测码==来检测数据在传输过程中是否产生了比特差错，是数据链路层所要解决的重要问题之一

#### 3.3.1 使用==循环冗余检验`CRC`==

![CRC](https://gitee.com/clibin/image-bed/raw/master/image-20231101192256040.png)

#### 3.3.2 示例

1. 发送方

![CRC](https://gitee.com/clibin/image-bed/raw/master/image-20231101193502184.png)

2. 接收方

![](https://gitee.com/clibin/image-bed/raw/master/image-20231101193959244.png)

#### **3.3.3 总结**

![](https://gitee.com/clibin/image-bed/raw/master/image-20231101194313756.png)

### 3.4 可靠传输

#### 3.4.1 可靠传输的概念

![](https://gitee.com/clibin/image-bed/raw/master/image-20231101194720144.png)

![](https://gitee.com/clibin/image-bed/raw/master/image-20231101195208168.png)

### 3.5 可靠传输的实现机制

#### 3.5.1 停止-等待协议(SW)

1. 基本原理

> 发送一个数据分组`DATA0`然后等待接收方发来确认信息`ACK0`后再传输下一个数据分组`DATA1` ，如果==超时未接收到==接收方发送的确认信息`ACK0`或者接==收到否认信息==`NAK`就重新发送上一个分组数据分组,数据分组和确认信息的编号都是用来区分和上一个分组或信息是否相同

![SW](https://gitee.com/clibin/image-bed/raw/master/image-20231101204223808.png)

2. 停止等待协议的信道利用率

> $$
> 利用率 = \frac{数据发送时延}{数据发送时延+2个传播时延+确认信息发送时延}
> $$
>
> 确认信息的发送时延一般忽略不计
>
> **总结：当往返时间远大于数据帧的发送时延时，信道利用率很低，如果出现超时重传，信道利用率更低**（卫星链路）

#### 3.5.2 回退N帧协议（GBN）

![](https://gitee.com/clibin/image-bed/raw/master/image-20231101215803331.png)

![](https://gitee.com/clibin/image-bed/raw/master/image-20231101211215263.png)

#### 3.5.3 选择重传协议（SR）

![](https://gitee.com/clibin/image-bed/raw/master/image-20231101212500499.png)

### 3.6 点对点协议(`PPP`)

1. 概述

> ==点对点协议==（Point-to-Point Protocol，PPP）是目前使用最广泛的点对点数据链路层协议
>
> 1. ==网络控制协议NCPs==
> 2. 封装成帧
> 3. ==链路控制协议LCP==

![PPP](https://gitee.com/clibin/image-bed/raw/master/image-20231101213541707.png)

2. PPP的==帧格式==

![](https://gitee.com/clibin/image-bed/raw/master/image-20231101221019454.png)

3. PPP的==透明传输==

![](https://gitee.com/clibin/image-bed/raw/master/image-20231103154439848.png)

3. PPP的==状态图==

![](https://gitee.com/clibin/image-bed/raw/master/image-20231101221315932.png)

### 3.7 媒体接入控制问题

#### 3.7.1 媒体接入控制/多址接入 问题

> 如何协调多个发送站点和接收站点对一个共享传输媒体的占用（==多个媒体同时发送信号导致冲突的问题==）

#### 3.7.2 静态划分信道

> - 频分多址
> - 时分多址
> - 码分多址
>
> ==**这种固定划分信道的方法非常不灵活，通常在物理层中使用，而不是数据链路层**==

#### 3.7.3 `CSMA/CD`协议

![](https://gitee.com/clibin/image-bed/raw/master/image-20231103161532858.png)

1. ==帧发送流程图==

![](https://gitee.com/clibin/image-bed/raw/master/image-20231103162311360.png)

![](https://gitee.com/clibin/image-bed/raw/master/image-20231103163826951.png)

2. **==争用期==  2τ ，即端到端传播时延的2倍**

![](https://gitee.com/clibin/image-bed/raw/master/image-20231103162720907.png)

3. ==最小帧长==
>
>    **最小帧长 = 争用期 x 数据传输速率**
> $$
>    l = 2τ * 数据传输速率
> $$

![](https://gitee.com/clibin/image-bed/raw/master/image-20231103162936995.png)

4. ==动态退避==：发生碰撞后进行重传，随着重传次数增加，退避时间也会逐渐增加，减小了碰撞的概率

![image-20231103163318636](https://gitee.com/clibin/image-bed/raw/master/image-20231103163318636.png)

5. ==帧接收流程图==

![](https://gitee.com/clibin/image-bed/raw/master/image-20231103163952585.png)

#### 3.7.4 `CSMA/CA`协议

![](https://gitee.com/clibin/image-bed/raw/master/202311062053040.png)

### 3.8 `MAC`、`IP`地址、`ARP`协议

#### 3.8.1 `MAC`地址

1. **MAC地址**是==对网络上各接口的唯一标识==，而不是对网络上各设备的唯一标识（路由器有多个接口，所以有多个MAC地址）

![](https://gitee.com/clibin/image-bed/raw/master/image-20231109211711863.png)

2. MAC地址格式
>
> 广播MAC地址为**==FF-FF-FF-FF-FF-FF==**

![](https://gitee.com/clibin/image-bed/raw/master/image-20231109212131157.png)

3. MAC帧有三种：==单播、广播、多播==

> 单播帧：==一对一==

![](https://gitee.com/clibin/image-bed/raw/master/image-20231109213737953.png)

> 广播帧：==一对全体==
>
> 广播地址：`FF-FF-FF-FF-FF-FF`

![](https://gitee.com/clibin/image-bed/raw/master/image-20231109214347270.png)

> 多播帧：==一对多==
>
> 多播地址：==第二个数是奇数代表是多播地址==

![](C:/Users/onebot/AppData/Roaming/Typora/typora-user-images/image-20231109214904611.png)

#### 3.8.2 `IP`地址

> （网络层再详细介绍）

![](https://gitee.com/clibin/image-bed/raw/master/image-20231109220004217.png)

#### 3.8.3 `ARP`协议

> 主机中保存了一个高速缓存表，==记录了IP和MAC的对应关系==

![](https://gitee.com/clibin/image-bed/raw/master/image-20231109221234731.png)

> ARP协议动态获取MAC地址

![](https://gitee.com/clibin/image-bed/raw/master/image-20231109221003126.png)

> **总结：`ARP`协议只能逐链路（相邻）使用，不能跨网络使用**

### 3.9 集线器和交换机的区别

![](https://gitee.com/clibin/image-bed/raw/master/image-20231109222104719.png)

![](https://gitee.com/clibin/image-bed/raw/master/image-20231109222736241.png)

### 3.10 透明网桥的生成树协议`STP`

> - 为了提高以太网的==可靠性==，有时需要在两个以太网之间使用多个透明网桥来提供==冗余链路==
> - 为了避免广播帧在环路中永久兜圈，透明网桥使用生成树协议`Spanning Tree Protocol`，可以在增加冗余链路提高网络可靠性的同时，又避免环路带来的问题

![](https://gitee.com/clibin/image-bed/raw/master/image-20231111200010935.png)

### 3.11 虚拟局域网`VLAN`

> 虚拟局域网（`Virtual Local Area Network`，VLAN）是一种将局域网内的站点划分成与物理位置无关的逻辑组的技术，一个逻辑组就是一个VLAN，VLAN中的各站点具有某些共同的应用需求

> ==广播风暴==：**广播风暴会浪费网络资源和各主机的CPU资源**
>
> - 可以使用路由器切割广播域，防止广播风暴，但是==成本较高==
> - 使用vlan技术划分广播域

> - `A`发送广播帧，`Access`接口接收并`打标签`,`PVID`和`VID`相同的Access端口可以接收该帧，进行==去标签转发==
>
> - `Trunk`端口的`PVID`如果等于该帧的`VID`，也会==先去标签转发，然后再打标签==，否则直接转发
> - **Trunk端口是连接两个交换机的**

![](https://gitee.com/clibin/image-bed/raw/master/image-20231111193532792.png)

### 3.12 相关习题

[第3章 数据链路层 习题（第1部分）](https://www.kdocs.cn/view/l/cl60fYfO1qZe)

[第3章 数据链路层 习题（第2部分）](https://www.kdocs.cn/view/l/cenjHDfYLe95)

---



## 4. 网络层

### 4.1 概述

> 网络层的主要任务：==将分组从源主机经过多个网络和多段链路传输到目的主机==，可以将该任务划分为==分组转发==和==路由选择==两种重要的功能

### 4.2 网络层提供的两种服务

#### 4.2.1 面向连接的虚电路服务

> - **虚电路表示这是一条逻辑上的连接，分组沿着这条逻辑连接按照存储转发方式传送，而==不是真正建立了一条物理连接==**
> - **分组的首部仅在连接建立阶段使用完整的目的主机地址，之后每个分组的首部只需要携带一条==虚电路编号==即可**

![](https://gitee.com/clibin/image-bed/raw/master/image-20231112213851481.png)

#### 4.2.2 无连接的数据报服务

> - `TCP/IP`使用的就是这种==简单灵活的==、==无连接的==、==不可靠的==数据报服务
> - **核心思想：==可靠通信应由用户主机来保证==**
> - **由于网络自身不提供端到端的可靠传输服务，这就使得网络中的路由器可以做得比较简单，==大大降低了网络造价==**
> - **这种设计思想的==运行方式灵活==、能够适应多种应用。因特网能够发展到今日的规模，充分证明了当初采取这种设计思想的==正确性==**

![](https://gitee.com/clibin/image-bed/raw/master/image-20231112220730923.png)

#### 4.2.3 IP地址

> **概念**

- 网际协议（`Internet Protocol`，`IP`）是`TCP/IP`体系结构网际层中的核心协议
- `IPv4`地址就是给因特网(Internet)上的每一台主机（或路由器）的每一个==接口==分配一个在全世界范围内是唯一的==32比特==的标识符

#### 4.2.4 分类编址的`IP`

![](https://gitee.com/clibin/image-bed/raw/master/image-20231112223308951.png)

#### 4.2.5 划分子网的`IP`

> **分类编址方法不够灵活且容易造成==大量地址浪费==，划分子网编址方法对其进行改进（“打补丁”）**

![](https://gitee.com/clibin/image-bed/raw/master/image-20231113184551320.png)

> 划分子网案例

![](https://gitee.com/clibin/image-bed/raw/master/image-20231113185650959.png)

#### 4.2.6 ==无分类编制==的`IP`

![](https://gitee.com/clibin/image-bed/raw/master/image-20231113190642722.png)

> ==无分类域间路由选择==（`C`lassless `I`nter-`D`omain `R`outing，`CIDR` ）

![](https://gitee.com/clibin/image-bed/raw/master/image-20231113190939322.png)

> **练习**

![](https://gitee.com/clibin/image-bed/raw/master/image-20231113193113576.png)

> **==路由聚合==**
>
> **找出共同前缀，其余位取0**

![](https://gitee.com/clibin/image-bed/raw/master/image-20231113193616181.png)

### 4.3 IP数据报的发送和转发过程

> **IP数据报的==发送==和==转发==过程**
>
> - **主机发送IP数据报**
>   - ==判断目的主机是否与自己在同一个网络：==
>     - 若在同一个网络，则属于==直接交付==，直接发送给目的主机
>     - 若不在同一个网络，则属于==间接交付==，传输给主机所在网络的默认网关(路由器)，==由默认网关帮忙转发==)
>
> - **路由器转发IP数据报**
>   - ==检查IP数据报首部是否出错：==
>     - 若出错，则直接丢弃该IP数据报并通告源主机
>     - 若没有出错，则进行转发
>   - ==根据IP数据报的目的地址在路由表中查找匹配的条目：==
>     - 若找到匹配的条目，则转发给条目中指示的下一跳；
>     - 若找不到，则丢弃该IP数据报并通告源主机；

![](https://gitee.com/clibin/image-bed/raw/master/010ac0446c7c01e405dd1b7baf38d50a.png)

> ==路由器不转发广播IP数据报==，即路由器隔离广播域，如果因特网中数量巨大的路由器收到广播IP数据报后都进行转发，则会==造成巨大的广播风暴，严重浪费因特网资源==
>
> - ==中继器==和==集线器==工作在==物理层==，**既不隔离冲突域也不隔离广播域**
> - ==网桥==和==交换机==(多端口网桥)工作在==数据链路层==，**可以隔离冲突域，不能隔离广播域**
> - ==路由器==工作在==网络层==，**既隔离冲突域，也隔离广播域**

### 4.4 静态路由配置

#### 1. 静态路由的配置

![](https://gitee.com/clibin/image-bed/raw/master/image-20231117222851885.png)

#### 2. 默认路由

1. 默认路由：默认路由条目中的目的网络`0.0.0.0/0`，其中`0.0.0.0`表示任意网络，而网络前缀“/0”（相应的地址掩码为`0.0.0.0`）是==最短的网络前缀==

2. 特定主机路由：特定主机路由条目中的目的网络`192.168.2.1/32`，其中`192.168.2.1`是特定主机的IP地址，而网络前缀“/32”（相应地址掩码为`255.255.255.255`）是==最长的网络前缀==
3. 路由器在查找转发表转发IP数据报时，遵循“最长前缀匹配”的原则，因此==默认路由匹配优先级最低，特定主机路由条目的匹配优先级最高==

![](https://gitee.com/clibin/image-bed/raw/master/image-20231117223841323.png)

